<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Secure Vault</title>

<style>
* { box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

html, body { overflow-y: auto; overflow-x: hidden; }
::-webkit-scrollbar { width:0; height:0; }

body {
  margin:0;
  min-height:100vh;
  background:#0b0e17;
  font-family:Tahoma,sans-serif;
  color:#fff;
}

.container { max-width:720px; margin:auto; padding:20px; }

.card {
  background:rgba(255,255,255,0.1);
  backdrop-filter:blur(18px);
  border-radius:20px;
  padding:20px;
}

h2 { text-align:center; margin-bottom:20px; }

.field {
  position:relative;
  margin-bottom:18px;
}

textarea, input {
  width:100%;
  border:none;
  border-radius:14px;
  padding:14px 44px 14px 14px;
  background:rgba(0,0,0,.35);
  color:#fff;
  font-size:14px;
}

textarea {
  min-height:140px;
  resize:none;
  font-family:Consolas,monospace;
}

.eye {
  position:absolute;
  left:12px;
  top:50%;
  transform:translateY(-50%);
  cursor:pointer;
  font-size:18px;
  opacity:.8;
}

.copy-paste-btn {
  position:absolute;
  right:12px;
  top:12px;
  background:none;
  border:none;
  font-size:20px;
  cursor:pointer;
  opacity:0.8;
}

.buttons {
  display:flex;
  gap:14px;
  margin:24px 0;
}

button {
  flex:1;
  padding:14px;
  border:none;
  border-radius:16px;
  font-size:15px;
  font-weight:bold;
  color:#fff;
}

#encryptBtn { background:#4cc2ff; }
#decryptBtn { background:#ff4c4c; }

.mode-selector {
  display: flex;
  justify-content: center;
  gap: 40px;
  margin: 20px 0;
  font-size: 14px;
}

.mode-option {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
}

.mode-option input[type="radio"] {
  appearance: none;
  width: 20px;
  height: 20px;
  border: 2px solid #555;
  border-radius: 50%;
  display: grid;
  place-content: center;
  transition: all 0.3s;
}

.mode-option input[type="radio"]:checked {
  border-color: #4cc2ff;
}

.mode-option input[type="radio"]::before {
  content: "";
  width: 12px;
  height: 12px;
  border-radius: 50%;
  transform: scale(0);
  transition: 0.2s transform ease;
  background-color: #4cc2ff;
}

.mode-option input[type="radio"]:checked::before {
  transform: scale(1);
}

.help {
  margin-top: 30px;
  padding: 16px;
  background: rgba(255,255,255,0.05);
  border-radius: 16px;
  font-size: 13px;
  line-height: 1.6;
  opacity: 0.9;
}

.help h3 { margin: 12px 0 8px; text-align: center; }

footer {
  margin-top:16px;
  text-align:center;
  font-size:12px;
  opacity:.6;
}
</style>
</head>

<body>
<div class="container">
  <div class="card">
    <h2>Secure Vault</h2>

    <div class="field">
      <textarea id="plainText" placeholder="Ù…ØªÙ† Ù…Ø­Ø±Ù…Ø§Ù†Ù‡ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ ÛŒØ§ Ù¾ÛŒØ³Øª Ú©Ù†ÛŒØ¯"></textarea>
      <span class="eye" id="togglePlain">ğŸ‘</span>
      <button class="copy-paste-btn" id="pasteBtn" title="Ù¾ÛŒØ³Øª Ø§Ø² Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯">ğŸ“„</button>
    </div>

    <!-- Ø§Ù†ØªØ®Ø§Ø¨ Ø­Ø§Ù„Øª Ú©Ø§Ø± -->
    <div class="mode-selector">
      <label class="mode-option">
        <input type="radio" name="appMode" value="file" checked>
        <span>Ø­Ø§Ù„Øª ÙØ§ÛŒÙ„ (Ø¯Ø§Ù†Ù„ÙˆØ¯/Ø¢Ù¾Ù„ÙˆØ¯)</span>
      </label>
      <label class="mode-option">
        <input type="radio" name="appMode" value="copy">
        <span>Ú©Ù¾ÛŒ / Ù¾ÛŒØ³Øª</span>
      </label>
    </div>

    <div class="field">
      <input id="password" type="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
      <span class="eye" id="togglePass">ğŸ‘</span>
    </div>

    <div class="buttons">
      <button id="encryptBtn">Encrypt</button>
      <button id="decryptBtn">Decrypt</button>
    </div>

    <div class="field">
      <textarea id="output" placeholder="Ø®Ø±ÙˆØ¬ÛŒ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯" readonly></textarea>
      <button class="copy-paste-btn" id="copyBtn" title="Ú©Ù¾ÛŒ Ø®Ø±ÙˆØ¬ÛŒ" style="display:none;">ğŸ“‹</button>
    </div>

    <input id="fileInput" type="file" accept=".txt,.enc" hidden>

    <!-- Ø±Ø§Ù‡Ù†Ù…Ø§ -->
    <div class="help">
      <h3>ğŸ“– Ø±Ø§Ù‡Ù†Ù…Ø§</h3>
      <p><strong>Ø­Ø§Ù„Øª ÙØ§ÛŒÙ„ (Ù¾ÛŒØ´â€ŒÙØ±Ø¶):</strong> Ù…Ù†Ø§Ø³Ø¨ Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ± â€“ ÙØ§ÛŒÙ„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ Ø¢Ù¾Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
      <p><strong>Ø­Ø§Ù„Øª Ú©Ù¾ÛŒ / Ù¾ÛŒØ³Øª (ØªÙˆØµÛŒÙ‡ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ú¯ÙˆØ´ÛŒ):</strong> Ø³Ø±ÛŒØ¹ Ùˆ Ø¨Ø¯ÙˆÙ† Ù…Ø´Ú©Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯.</p>
      <p><strong>Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ:</strong> Ù…ØªÙ† â†’ Ø±Ù…Ø² â†’ Ø®Ø±ÙˆØ¬ÛŒ (Ø¯Ø± Ø­Ø§Ù„Øª Ú©Ù¾ÛŒ/Ù¾ÛŒØ³Øª ÙÙ‚Ø· Ù†Ù…Ø§ÛŒØ´ + Ú©Ù¾ÛŒ)</p>
      <p><strong>Ø±Ù…Ø²Ú¯Ø´Ø§ÛŒÛŒ:</strong> Ù…ØªÙ† Ø±Ù…Ø² Ø´Ø¯Ù‡ â†’ Ø±Ù…Ø² â†’ Ù…ØªÙ† Ø§ØµÙ„ÛŒ (Ø¯Ø± Ø­Ø§Ù„Øª Ú©Ù¾ÛŒ/Ù¾ÛŒØ³Øª Ù…Ø³ØªÙ‚ÛŒÙ… Ø§Ø² Ø¨Ø§Ú©Ø³ ÙˆØ±ÙˆØ¯ÛŒ)</p>
    </div>

    <footer>AES-256-GCM â€¢ PBKDF2 â€¢ 100% Client-Side</footer>
  </div>
</div>

<script>
const enc = new TextEncoder();
const dec = new TextDecoder();

const plainText = document.getElementById("plainText");
const password  = document.getElementById("password");
const output    = document.getElementById("output");
const fileInput = document.getElementById("fileInput");
const copyBtn   = document.getElementById("copyBtn");
const pasteBtn  = document.getElementById("pasteBtn");

const encryptBtn = document.getElementById("encryptBtn");
const decryptBtn = document.getElementById("decryptBtn");

// Ú†Ø´Ù…â€ŒÙ‡Ø§
document.getElementById("togglePlain").onclick = () => {
  plainText.style.webkitTextSecurity = plainText.style.webkitTextSecurity === "disc" ? "none" : "disc";
};

document.getElementById("togglePass").onclick = () => {
  password.type = password.type === "text" ? "password" : "text";
};

// Ø¯Ú©Ù…Ù‡ Ù¾ÛŒØ³Øª
pasteBtn.onclick = async () => {
  try {
    const text = await navigator.clipboard.readText();
    plainText.value = text.trim();
    alert("Ù…ØªÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù¾ÛŒØ³Øª Ø´Ø¯!");
  } catch (err) {
    alert("Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯ Ø¯Ø§Ø¯Ù‡ Ù†Ø´Ø¯Ù‡ ÛŒØ§ Ú†ÛŒØ²ÛŒ Ú©Ù¾ÛŒ Ù†Ø´Ø¯Ù‡.");
  }
};

// Ø¯Ú©Ù…Ù‡ Ú©Ù¾ÛŒ
copyBtn.onclick = () => {
  output.select();
  document.execCommand("copy");
  alert("Ù…ØªÙ† Ø®Ø±ÙˆØ¬ÛŒ Ú©Ù¾ÛŒ Ø´Ø¯!");
};

// ØªÙˆØ§Ø¨Ø¹ Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±)
async function deriveKey(pass, salt) {
  const base = await crypto.subtle.importKey("raw", enc.encode(pass), "PBKDF2", false, ["deriveKey"]);
  return crypto.subtle.deriveKey(
    {name: "PBKDF2", salt, iterations: 200000, hash: "SHA-256"},
    base, {name: "AES-GCM", length: 256}, false, ["encrypt", "decrypt"]
  );
}

async function encrypt(text, pass) {
  const salt = crypto.getRandomValues(new Uint8Array(16));
  const iv   = crypto.getRandomValues(new Uint8Array(12));
  const key  = await deriveKey(pass, salt);
  const cipher = await crypto.subtle.encrypt({name: "AES-GCM", iv}, key, enc.encode(text));
  return btoa(String.fromCharCode(...salt, ...iv, ...new Uint8Array(cipher)));
}

async function decrypt(data, pass) {
  const raw = Uint8Array.from(atob(data), c => c.charCodeAt(0));
  const salt = raw.slice(0,16);
  const iv   = raw.slice(16,28);
  const ct   = raw.slice(28);
  const key  = await deriveKey(pass, salt);
  const plain = await crypto.subtle.decrypt({name: "AES-GCM", iv}, key, ct);
  return dec.decode(plain);
}

// Encrypt
encryptBtn.onclick = async () => {
  if (!password.value) return alert("Ø±Ù…Ø² ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡");
  if (!plainText.value.trim()) return alert("Ù…ØªÙ† Ø®Ø§Ù„ÛŒ Ø§Ø³Øª");

  try {
    const result = await encrypt(plainText.value.trim(), password.value);
    output.value = result;

    const isCopyMode = document.querySelector('input[name="appMode"]:checked').value === "copy";

    if (isCopyMode) {
      copyBtn.style.display = "block";
      alert("Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ Ù…ÙˆÙÙ‚! Ø­Ø§Ù„Ø§ Ø±ÙˆÛŒ ğŸ“‹ Ø¨Ø²Ù†ÛŒØ¯ Ùˆ Ù…ØªÙ† Ø±Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯.");
    } else {
      // Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ ÙÙ‚Ø· Ø¯Ø± Ø­Ø§Ù„Øª ÙØ§ÛŒÙ„
      const blob = new Blob([result], {type: "text/plain"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "secure.enc";
      document.body.appendChild(a);
      a.click();
      setTimeout(() => { URL.revokeObjectURL(url); a.remove(); }, 300);
      alert("ÙØ§ÛŒÙ„ Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒâ€ŒØ´Ø¯Ù‡ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯ (secure.enc)");
    }

    plainText.value = "";
    password.value = "";
  } catch (e) {
    alert("Ø®Ø·Ø§ Ø¯Ø± Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ");
  }
};

// Decrypt
decryptBtn.onclick = () => {
  if (!password.value) return alert("Ø±Ù…Ø² ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡");

  const isCopyMode = document.querySelector('input[name="appMode"]:checked').value === "copy";

  if (isCopyMode) {
    if (!plainText.value.trim()) return alert("ÙˆØ±ÙˆØ¯ÛŒ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª! Ù…ØªÙ† Ø±Ù…Ø² Ø´Ø¯Ù‡ Ø±Ø§ Ù¾ÛŒØ³Øª Ú©Ù†ÛŒØ¯ (Ø¯Ú©Ù…Ù‡ ğŸ“„)");
    decryptFromText();
  } else {
    fileInput.click();
  }
};

async function decryptFromText() {
  try {
    output.value = await decrypt(plainText.value.trim(), password.value);
    plainText.value = "";
  } catch (e) {
    alert("Ø±Ù…Ø² Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª ÛŒØ§ Ù…ØªÙ† Ø®Ø±Ø§Ø¨ Ø§Ø³Øª");
  }
}

fileInput.onchange = async () => {
  if (!fileInput.files[0]) return;
  try {
    const text = await fileInput.files[0].text();
    output.value = await decrypt(text, password.value);
  } catch (e) {
    alert("Ø±Ù…Ø² Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª ÛŒØ§ ÙØ§ÛŒÙ„ Ø®Ø±Ø§Ø¨ Ø§Ø³Øª");
  }
  fileInput.value = "";
};
</script>
</body>
</html>